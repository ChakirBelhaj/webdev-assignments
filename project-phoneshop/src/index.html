<!DOCTYPE html>
<html>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <head>
        <title>Illegal phoneshop America</title>
        <link rel="stylesheet" type="text/css" href="./css/styles.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    </head>

    <body style="background-image: url('https://wallpaperaccess.com/full/1611219.jpg');">
        <nav>
            <ul class="navBar">
                <li><a href="index.html">Home</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
        </nav>

        <section>
            <h1><abbr title="World Health Organization">Illegal</abbr> phoneshop America</h1>
            <h2>Keep it quiet</h2>
            <p>
                The World Wide Fund for Nature (WWF) is an international organization working on issues regarding the conservation, research and restoration of
                the environment, formerly named the World Wildlife Fund. WWF was founded in 1961.
            </p>
        </section>

        <form id="phonesForm">
            <table class="center overflowAuto" id="phonesTable">
                <caption>
                    Stolen phones
                </caption>
            </table>
            <button type="submit">Add</button>
        </form>
    </body>
    <footer class="footer">
        <p>Created by: Chakir Belhaj & Ahmed Mous</p>
        <p>Contact information: <a href="mailto:chakir.belhaj@outlook.com"> chakir.belhaj@outlook.com</a>.</p>
    </footer>
</html>

<script>
    $(document).ready(function() {
        getPhoneData();
        $("#phonesForm").submit(function(e) {
            e.preventDefault();
            createPhone();
        });
    });

    function createPhone() {
        var data = $("#phonesForm").serializeArray();
        $.ajax({
            url: "https://wt.ops.labs.vu.nl/api20/2b9115a4",
            data: {
                brand: data[0].value,
                model: data[1].value,
                os: data[2].value,
                image: data[3].value,
                screensize: data[4].value
            },
            method: "POST",
            success: function(result) {
                addPhoneToTable(data);
            },
            error: function(error) {
                console.log(error);
            }
        });
    }

    function addPhoneToTable(data) {
        $("#phonesTable").append(
            "<tr>" +
                "<td><img class='imageInTable' src=" +
                data[0].value +
                "></td>" +
                "<td>" +
                data[1].value +
                "</td>" +
                "<td>" +
                data[2].value +
                "</td>" +
                "<td>" +
                data[3].value +
                "</td>" +
                "<td>" +
                data[4].value +
                "</td>" +
                "</tr>"
        );
    }

    function getPhoneData() {
        $.ajax({
            url: "https://wt.ops.labs.vu.nl/api20/2b9115a4",
            context: document.body,
            method: "GET",
            success: function(result) {
                populateTable(result);
            }
        });
    }

    function populateTable(phonesData) {
        console.log(phonesData);
        var table = $("#phonesTable");
        $.each(phonesData, function(idx, phone) {
            table.append(
                "<tr>" +
                    "<td><img class='imageInTable' src=" +
                    phone.image +
                    "></td>" +
                    "<td>" +
                    phone.brand +
                    "</td>" +
                    "<td>" +
                    phone.model +
                    "</td>" +
                    "<td>" +
                    phone.os +
                    "</td>" +
                    "<td>" +
                    phone.screensize +
                    "</td>" +
                    "</tr>"
            );
        });
        addFormRowToTable(table);
    }

    function addFormRowToTable(table) {
        table.append(
            "<tr>" +
                "<td><input value='s' required type='text' name='brand' /></td>" +
                "<td><input value='s' required type='text' name='model' /></td>" +
                "<td><input value='s' required type='text' name='os' /></td>" +
                "<td><input value='s' required type='text' name='image' /></td>" +
                "<td><input value='2' required type='number' name='screensize' /></td>" +
                "</tr>"
        );
    }
</script>
