<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Illegal phoneshop America</title>
        <link rel="stylesheet" type="text/css" href="./css/styles.css" />
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"></script>
    </head>

    <body>
        <nav class="hidden-print">
            <ul class="navBar">
                <li><a href="index.html">Home</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
        </nav>
        <section>
            <h1 class="title"><abbr title="World Health Organization">Illegal</abbr> phoneshop America</h1>
            <h2>Keep it quiet</h2>
            <p class="fontSize20 center">
                We are a World Wide criminal organization for illegal phone selling.
            </p>
        </section>

        <form id="overflowAuto">
            <table id="example">
                <caption>
                    Stolen phones
                </caption>
                <thead>
                    <tr class="imageInTable">
                        <th id="test" name="test">Image</th>
                        <th id="2">Brand</th>
                        <th id="3">Model</th>
                        <th id="4">Operation system</th>
                        <th id="5">Screensize</th>
                    </tr>
                </thead>
                <tbody id="phonesTableBody">
                    <tr id="tableFormRow">
                        <td><input value="d" required type="text" name="brand" /></td>
                        <td><input value="t" required type="text" name="model" /></td>
                        <td><input value="pm" required type="text" name="os" /></td>
                        <td><input value="t" required type="text" name="image" /></td>
                        <td><input value="2" required type="number" name="screensize" /></td>
                    </tr>
                </tbody>
            </table>
            <button class="positiveButton hidden-print" type="submit">Add</button>
        </form>
        <button onclick="resetData()">Reset</button>

        <table class="hidden-print">
            <caption class="fontSize20 hidden-print">
                Employees
            </caption>
            <thead>
                <tr class="tableheader">
                    <th>Name</th>
                    <th>Nickname</th>
                    <th>Phonenumber</th>
                    <th>Living state</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Chakir</td>
                    <td>The prospect</td>
                    <td>NAN</td>
                    <td>Unknown</td>
                </tr>
                <tr>
                    <td>Ahmed</td>
                    <td>Mystery</td>
                    <td>202-555-0191,</td>
                    <td>Washington</td>
                </tr>
                <tr>
                    <td>Federico</td>
                    <td>Corleone</td>
                    <td>202-551-0192,</td>
                    <td>New york</td>
                </tr>
            </tbody>
        </table>
        <footer class="footer hidden-print">
            <p>Created by: Chakir Belhaj & Ahmed Moussa</p>
            <p>Contact information: <a href="mailto:chakir.belhaj@outlook.com"> chakir.belhaj@outlook.com</a>.</p>
        </footer>
    </body>
</html>

<script>
    $(document).ready(function() {
        $("#phonesForm").submit(function(e) {
            e.preventDefault();
            createPhone();
        });
        $(document).ready(function() {
            $("#example").DataTable({
                responsive: true,
                columns: [{ data: "brand" }, { data: "model" }, { data: "os" }, { data: "image" }, { data: "screensize" }]
            });
            getPhoneData();
        });
    });

    function resetData() {
        $.ajax({
            url: "https://wt.ops.labs.vu.nl/api20/2b9115a4/reset",
            method: "GET",
            success: function(result) {
                $("#phonesTableBody")
                    .children()
                    .not(":first")
                    .not(":nth-child(2)")
                    .not(":last")
                    .remove();
            },
            error: function(error) {
                console.log(error);
            }
        });
    }

    function getPhoneData() {
        $.ajax({
            url: "https://wt.ops.labs.vu.nl/api20/2b9115a4",
            context: document.body,
            method: "GET",
            success: function(result) {
                console.log(result);
                populateTable(result);
            }
        });
    }

    function populateTable(phonesData) {
        $.each(phonesData, function(idx, phone) {
            addPhoneToTable(phone);
        });
    }

    function addPhoneToTable(data) {
        console.log(data);
        var table = $("#example").DataTable();
        table.row
            .add({
                brand: data.brand,
                model: data.model,
                os: data.os,
                image: data.image,
                screensize: data.screensize
            })
            .draw();
    }

    function createPhone() {
        var data = $("#phonesForm").serializeArray();
        $.ajax({
            url: "https://wt.ops.labs.vu.nl/api20/2b9115a4",
            data: {
                brand: data[0].value,
                model: data[1].value,
                os: data[2].value,
                image: data[3].value,
                screensize: data[4].value
            },
            method: "POST",
            success: function(result) {
                addPhoneToTable(data);
            },
            error: function(error) {
                console.log(error);
            }
        });
    }
</script>
